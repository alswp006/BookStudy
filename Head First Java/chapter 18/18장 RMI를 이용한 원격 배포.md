# RMI를 이용한 원격 배포
## 메소드 호출
- 메소드 호출은 항상 같은 힙에 들어있는 두 객체 사이에서 이루어진다.
- 만약 컴퓨터 1에 있는 객체 A가 컴퓨터 2에 있는 객체 B의 메소드를 호출하고 싶다면 어떻게 해야할까 -> RMI(원격 메소드 호출)을 사용하면 된다.
## 보조 객체
- 보조객체는 실제 통신 작업을 처리하는 객체이다.
- 클라이언트 보조 객체는클라이언트가 로컬 객체에 있는 메소드를 호출하는 척하는 것을 가능하게 해준다.
  - 클라이언트 보조 객체가 서비스 객체처럼 행세하기 때문에 클라이언트 객체에서는 실제로 원격 서비스의 메소드를 호출한다고 생각하게 된다.
  - 결국 클라이언트 보조 객체는 클라이언트에서 호출하려고 하는 메소드를 가지고 있는 객체인 척하는 개념이다.
  - 클라이언트 보조 객체는 서버와 접촉하고 메소드 호출에 대한 정보를 전송한 뒤 서버에서 결과를 리턴할 때까지 기다린다.
- 서버 쪽에서는 서비스 보조 객체에서 소켓 연결을 통해 클라이언트 보조 객체에서 보낸 요청을 받아서 호출에 대한 정보를 열어보고 진짜 서비스 객체에 있는 진짜 메소드를 호출한다.
  - 원격 클라이언트가 아닌 같은 힙에 있는 서비스 보조 객체에서 메소드를 호출하기 때문에 서비스 객체 입장에서는 로컬 객체에서 그 메소드를 호출한 것이 된다.
- 서비스 보조 객체는 서비스로부터 리턴 값을 받아서 포장한 뒤 다시 소켓의 출력 스트림을 통해 클라이언트 보조 객체로 보낸다.
### 메소드 호출 과정
1. 클라이언트 객체에서 클라이언트 보조 객체에 있는 test()메소드를 호출한다.
2. 클라이언트 보조 객체에서 메소드 호출에 대한 정보(인자, 메소드명 등)을 포장해서 네트워크를 통해 서비스 보조 객체로 보낸다.
3. 서비스 보조 객체에서 클라이언트 보조 객체로부터 받은 정보를 풀어서 진짜 서비스 객체에 있는 메소드를 호출한다.
## RMI
- 자바 RMI가 클라이언트와 서비스 보조 객체를 제공한다.
- RMI는 클라이언트에서 클라이언트 보조 객체를 찾고 가져올 수 있게 해주는 룩업 시스템을 비롯한 모든 필요한 기반을 제공한다.
- RMI를 사용하면 네트워킹이나 입출력 코드를 직접 만들 필요 없이 클라이언트에서는 같은 JVM에서 돌아가는 객체의 메소드를 호출하는 것처럼 원격 메소드를 호출할 수 있다.
- 이러한 방법은 예외에 대한 위험 요소가 있기 때문에 클라이언트는 그런 위험이 있다는 것을 인식할 필요가 있다.
- 즉, 원격 메소드를 호출할 때 클라이언트 입장에서는 보조 객체에 대한 로컬 메소드 호출이지만 그 호출이 소켓, 스트림과 연관되어 있다는 점을 알아야 한다.
- RMI를 사용할 때 JRMP, HOP의 규약 중 하나를 사용할 수 있다.
  - JRMP : 자바 원격 호출을 하기 위한 용도만으로 만들어짐
  - IIOP : COBRA(Common Object Request Broke Architecture)용 규약이며 자바가 아닌 원격 객체에 있는 것도 호출할 수 있는 규약이다.
### 원격 서비스 만들기
1. 원격 인터페이스를 만든다.
   - 클라이언트에서 원격으로 호출할 수 있는 메소드를 정의하는 부분
2. 원격 인터페이스를 구현할 클래스를 만든다.
  - 클래스의 실제 작업 처리
3. rmic를 위용하여 스터브와 스켈레톤을 생성한다.
  - 스터브와 스켈레톤은 각각 클라이언트와 서버 보조 객체이다. JDK에 있는 rmic 도구를 실행시키면 자동으로 처리된다.
4. RMI 레지스트리를 시작한다.
  - 레지스트리는 목차와 비슷한 것인데 사용자가 클라이언트 보조 객체를 얻을 때 이를 사용한다.
5. 원격 서비스를 시작한다.
### 클라이언트에서 스터브 객체를 받는 방법
1. 클라이언트에서 RMI 레지스트리에 대한 룩업 작업을 한다.
2. RMI 레지스트리에서 스터브 객체를 리턴한다.
3. 클라이언트에서 실제 서비스의 메소드를 호출하는 것처럼 스터브의 메소드를 호출한다.
### 클라이언트에서 스터브 클래스를 받는 방법
- 동적 클래스 다운로딩
## 서블릿
- 서블릿은 HTTP 웹 서버에서 웹 서버와 함께 돌아가는 자바 프로그램이다.
- 클라이언트에서 웹 브라우저를 써서 웹 페이지와 정보를 주고받을 때 HTTP 요청이 웹 서버로 전송된다.
- 그 요청을 응답하는데 자바 서블릿이 필요하다면 웹 서버에서 서블릿 코드를 실행시킨다.
- 서블릿 코드는 클라이언트의 요청에 따라 필요한 작업을 처리하기 위해 서버에서 실행되는 코드이다.
- 서블릿에서도 RMI를 사용할 수 있다.
- J2EE 기술은 서블릿과 EJB를 혼합하기 위한 용도로 가장 많이 쓰이는데 이 때 서블릿이 EJB의 클라이언트가 된다. 이 경우 서블릿은 RMI를 사용하여 EJB와 정보를 주고받는다.
### 서블릿을 만들고 실행시키는 방법
1. 서블릿을 저장해야 하는 위치를 알아낸다.
2. servlets.jar를 구해서 클래스경로에 추가한다.
3. HttpServelet을 확장하여 서블릿 클래스를 만든다.
4. 서블릿을 호출하는 HTML 페이지를 만든다.
   - 사용자가 서블릿으로 연결ㄹ되는 링크를 클릭하면 웹 서버에서는 서블릿을 찾아서 HTTP 명령(GET, POST 등)에 따라 적절한 메소드를 호출한다.
5. 서블릿과 HTML을 웹 서버에서 사용할 수 있게 만든다.
## 엔터프라이즈 자바빈즈 : 초강력 RMI
- RMI만 가지고 거대한 사이트를 만들 수는 없어서 엔터프라이즈 엔터프라이즈 서버가 필요하다.
- J2EE 서버에는 웹 서버와 엔터프라이즈 자바진즈 서버가 모두 포함되어 있기 때문에 서블릿과 EJB가 모두 들어있는 애플리케이션을 돌릴 수 있다.
- EJB 서버는 RMI만 가지고는 하기 힘든 다양한 서비스(트랜잭션, 보안, 데이터베이스 관리, 네트워킹)를 제공한다.
- EJB 서버는 RMI 호출과 모든 서비스에 있는 층 사이에 들어간다.
## 지니
- 지니에서는 RMI를 사용하지만 어댑티브 디스커버리, 자가 치유 네트워크 등의 기능들도 제공한다.
- RMI를 사용하려면 클라이언트에서 원격서비스의 이름과 위치를 알아야 했지만 지니를 사용할 때는 서비스에서 구현한 인터페이스만 알면 된다.
